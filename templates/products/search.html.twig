{% extends 'base.html.twig' %}
{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ asset('assets/css/category.css') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<link rel="stylesheet" type="text/css"
    href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}
{% block header %}
<!-- banner bg main start -->
   <div class="banner_bg_main">
      <!-- header top section start -->
      <div class="container">
         <div class="header_section_top">
            <div class="row">
               <div class="col-sm-12">
                  
                  <div class="logo_section">
                     <div class="container">
                        <div class="row">
                           <div class="col-sm-12">
                              <div class="logo"><a href="{{ path("app_home") }}" id="logo_title">Mondoudou</a></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="header_section">
                     <div class="container">
                        <div class="containt_main">
                           
                           <span class="toggle_icon" onclick="openNav()"><img src="{{ asset('assets/images/toggle-icon.png') }}" alt=""></span>
                          
                           <div class="main">
                              <!-- Another variation with a button -->
                              <div class="input-group">
                                 <form class="d-flex w-100 search-form" method="get" action="{{ path('app_search') }}" onsubmit="return validateSearchForm()">
                                    <input type="text" class="form-control" placeholder="Rechercher un produit" name="searchTerm" id="searchTerm">
                                    <div class="input-group-append">
                                       <button class="btn btn-secondary" type="submit" style="background-color: #5D3D29; border: none;">
                                       <i class="fa fa-search"></i>
                                       </button>
                                    </div>
                                 </form>
                              </div>
                              {# <div class="logo"><a href="{{ path("app_home") }}" id="logo_title">Mondoudou</a></div> #}

                           </div>
                           <div class="header_box">
                              <div class="login_menu">
                                 <ul>
                                    <li>
                                          <a href="{{ path('app_panier') }}">
                                          <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                          <span id="custom_link" class="padding_10">Panier</span></a>
                                    </li>
                                    {% if is_granted('ROLE_USER') %}
                                    <li>
                                          <a href="{{ path("app_profil") }}">
                                          <i class="fa fa-user" aria-hidden="true"></i>
                                          <span id="custom_link" class="padding_10">Compte</span></a>
                                    </li>
                                    <li>
                                          <a href="{{ path('app_logout') }}">
                                          <i class="fa fa-user" aria-hidden="true"></i>
                                          <span id="custom_link" class="padding_10">Deconnexion</span></a>
                                    </li>
                                    {% else %}
                                    <li>
                                          <a href="{{ path('app_login') }}">
                                          <i class="fa fa-user" aria-hidden="true"></i>
                                          <span id="custom_link" class="padding_10">Se connecter</span></a>
                                    </li>
                                    {% endif %}
                                 </ul>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="{{ path("app_home") }}">Home</a>
            <a href="{{ path("app_category", {id: peluchesCategory.id}) }}">Peluches</a>
            <a href="{{ path("app_category", {id: doudousCategory.id}) }}">Doudous</a>
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#joinModal1">Contact</a>
         </div>
         {# header_section Two when screen is small #}
         <div class="header_section headerTwo d-none">
            <div class="container">
               <div class="containt_main">
                  <div id="mySidenav" class="sidenav">
                     <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                     <a href="{{ path("app_home") }}">Home</a>
                     <a href="{{ path("app_category", {id: peluchesCategory.id}) }}">Peluches</a>
                     <a href="{{ path("app_category", {id: doudousCategory.id}) }}">Doudous</a>
                     <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#joinModal1">Contact</a>
                  </div>
                  <span class="toggle_icon" onclick="openNav()"><img src="{{ asset('assets/images/toggle-icon.png') }}" alt=""></span>
                  {# <div class="dropdown">
                     <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">All Category 
                     </button>
                     <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <a class="dropdown-item" href="#">Something else here</a>
                     </div>
                  </div> #}
                  <div class="main m-0">
                     <!-- Another variation with a button -->
                     <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search this blog">
                        <div class="input-group-append">
                           <button class="btn btn-secondary" type="button" style="background-color: #f26522; border-color:#f26522 ">
                           <i class="fa fa-search"></i>
                           </button>
                        </div>
                     </div>
                  </div>
                  <div class="header_box">
                     
                     <div class="login_menu">
                        <ul>
                           <li><a href="#">
                              <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                              <span class="padding_10">Cart</span></a>
                           </li>
                           <li><a href="#">
                              <i class="fa fa-user" aria-hidden="true"></i>
                              <span class="padding_10">Cart</span></a>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
                     <div class="logo"><a href="{{ path("app_home") }}" id="logo_title">Mondoudou</a></div>
         </div>

      </div>
   </div>
   
{% endblock %}
{% block body %}
        <!-- Section-->
        <section class="py-5 mt-5">
            <div class="container px-4 px-lg-5 mt-5">

                {# Affichage du message flash #}
                {% for message in app.flashes('add_success') %}
                    <div class="alert alert-success alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}

                {# Affichage du message flash #}
                {% for message in app.flashes('edit_success') %}
                    <div class="alert alert-warning alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}

                {# Affichage du message flash #}
                {% for message in app.flashes('delete_success') %}
                    <div class="alert alert-danger alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}                               

                <h2 id='titre_peluche' class='text-center my-5'>Recherche</h2>
               {% if photos is empty %}
                  <div class="row w-100 text-center mt-5 search-main">
                  <h5>Nous sommes désolés, aucun produits ne correspond à votre recherche</h5>
                  </div>
               {% else %}
               {# <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center mt-5"> #}
               <div class="row search-card justify-content-center">
                  {% for photo in photos %}
                  <div class="col-lg-3 col-sm-3">
                           <div class="card-index box_main">
                              <h4 class="shirt_text pt-2">{{ photo.product.name }}</h4>
                              <p class="price_text">Prix <span style="color: #262626;">€ {{ photo.product.price }}</span></p>
                              <div class="tshirt_img"><img src="images/photos/{{ photo.imageName }}" alt="" style="height: 250px"></div> 
                              {# message de notifications #}
                              <div id="notification-cat" class="alert alert-success " role="alert" style="display:none;">
                                 Produit ajouté au panier
                              </div>
                              <div class="btn_main">
                                 <div class="buy_bt"><a class="add-to-cart" id="add" href="" data-id="{{ photo.product.id }}">Ajouter au panier</a></div>
                                 <div class="seemore_bt"><a href="{{ path("app_product", {id: photo.product.id}) }}">Voir plus</a></div>
                              </div>
                           </div>
                        </div>
                  {% endfor %}
               {% endif %}

                   
                </div>
            </div>
        </section>
<script>
const addButtons = document.querySelectorAll("#add");
  addButtons.forEach((addButton) => {
    addButton.addEventListener("click", (event) => {
      event.preventDefault();
      const productId = event.target.getAttribute("data-id");
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "/panier/add/" + productId);
      xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
      xhr.onload = function () {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          if (response.success) {
            const notif =
              event.target.parentElement.parentElement.parentElement
                .children[3];
            console.log(notif);
            notif.classList.add("show");
            setTimeout(function () {
              notif.classList.remove("show");
            }, 5000);
            const cartItemCount = document.getElementById("cart_items_count");
            cartItemCount.innerHTML = response.totalQuantity;
			console.log(response.totalQuantity);
          } else {
            alert("Une erreur est survenue : " + response.message);
          }
        } else {
          alert("Une erreur est survenue");
        }
      };
      xhr.send();
    });
  });
</script>
{% endblock %}
